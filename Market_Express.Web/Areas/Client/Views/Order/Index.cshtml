@model Market_Express.Web.ViewModels.Order.MyOrdersViewModel
@{
    ViewData["Title"] = "Mis Pedidos";
}


<!-- ========================= SECTION PAGETOP ========================= -->
<section class="section-pagetop bg">
    <div class="container">
        <h2 class="title-page font-weight-bold">Mis Pedidos</h2>
        <nav>
            <ol class="breadcrumb text-white">
                <li class="breadcrumb-item"><a asp-area="" asp-controller="Home" asp-action="Index">Inicio</a></li>
                <li class="breadcrumb-item active" aria-current="page">Mis Pedidos</li>
            </ol>
        </nav>
    </div>
</section>
<!-- ========================= SECTION INTRO END// ========================= -->

<section class="section-content padding-y">
    <div class="container">

        <div class="row">
            <aside class="col-md-2 mb-3">
                <div class="list-group" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                    <a class="list-group-item active" id="v-pills-re-tab" data-toggle="pill" href="#v-pills-re" role="tab" aria-controls="v-pills-re" aria-selected="true">Resumen</a>
                    <a class="list-group-item" id="v-pills-od-tab" data-toggle="pill" href="#v-pills-od" role="tab" aria-controls="v-pills-od" aria-selected="false">Todos los Pedidos</a>
                </div>
            </aside>
            <main class="col-md-10">
                <article class="card mb-3">
                    <div class="card-body">
                        <div class="tab-content" id="v-pills-tabContent">
                            <div class="tab-pane fade show active" id="v-pills-re" role="tabpanel" aria-labelledby="v-pills-re-tab">
                                <div class="card-body">
                                    <h4>Resumen</h4>
                                    <hr />
                                    <div class="row">
                                        <div class="col-md-4">
                                            <figure class="item-feature">
                                                <span class="text-primary"><i class="fa fa-2x fa-truck"></i></span>
                                                <figcaption class="pt-3">
                                                    <h5 class="title">Entrega rápida</h5>
                                                    <p class="text-justify">Tus pedidos serán entregados en menos de 24 horas sin ningún costo adicional (Sujeto a cobertura y disponibilidad).</p>
                                                </figcaption>
                                            </figure>
                                        </div>
                                        <div class="col-md-4">
                                            <figure class="item-feature">
                                                <span class="text-primary"><i class="fa fa-2x fa-shopping-basket"></i></span>
                                                <figcaption class="pt-3">
                                                    <h5 class="title">Pago contra entrega</h5>
                                                    <p class="text-justify">
                                                        Realiza tu pago en efectivo al recibir tus productos o por medio de una transferencia SINPE al 87389387.
                                                    </p>
                                                </figcaption>
                                            </figure>
                                        </div>
                                        <div class="col-md-4">
                                            <figure class="item-feature">
                                                <span class="text-primary"><i class="fa fa-2x fa-check-double"></i></span>
                                                <figcaption class="pt-3">
                                                    <h5 class="title">Calidad al mejor precio</h5>
                                                    <p class="text-justify">
                                                        Garantizamos la calidad de nuestros productos a precio competitivos.
                                                    </p>
                                                </figcaption>
                                            </figure>
                                        </div>
                                    </div>
                                    <hr />
                                    <div class="row">
                                        <div class="col-md-4 d-flex mb-3 mb-md-0">
                                            <div class="align-self-center mx-auto" align="center">
                                                <button class="btn btn-danger btn-lg">Cancelar más reciente</button>
                                            </div>
                                        </div>
                                        <div class="col-md-8">
                                            <article class="card-group">
                                                <figure class="card bg">
                                                    <div class="p-3">
                                                        <h5 class="card-title">@Model.OrderStats.Pending</h5>
                                                        <span>Pendientes</span>
                                                    </div>
                                                </figure>
                                                <figure class="card bg">
                                                    <div class="p-3">
                                                        <h5 class="card-title">@Model.OrderStats.Finished</h5>
                                                        <span>Terminados</span>
                                                    </div>
                                                </figure>
                                                <figure class="card bg">
                                                    <div class="p-3">
                                                        <h5 class="card-title">@Model.OrderStats.Canceled</h5>
                                                        <span>Cancelados</span>
                                                    </div>
                                                </figure>
                                            </article>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <h5 class="card-title mb-4">Pedidos Recientes</h5>

                                    <div class="row">
                                        @if (Model.RecentOrders.Count > 0)
                                        {
                                            @foreach (var order in Model.RecentOrders)
                                            {
                                                string textClass = "text-primary";

                                                if (order.Status == OrderStatus.PENDIENTE)
                                                {
                                                    textClass = "text-warning";
                                                }
                                                else if (order.Status == OrderStatus.CANCELADO)
                                                {
                                                    textClass = "text-danger";
                                                }

                                                string src = order.MostRequestedArticleImage != null
                                                                            ? @Url.Action("GetImage", "Resource", new { area = "", n = order.MostRequestedArticleImage })
                                                                            : "/img/NotAvailable.png";

                                                <div class="col-md-4">
                                                    <figure class="itemside  mb-3">
                                                        <a asp-area="Client"
                                                           asp-controller="Order"
                                                           asp-action="Details"
                                                           asp-route-id="@order.Id"
                                                           class="aside">
                                                            <img src="@src" class="border img-sm">
                                                        </a>
                                                        <figcaption class="info">
                                                            <time class="text-muted"><i class="fa fa-calendar-alt"></i> @order.CreationDate.ToShortDateString()</time>
                                                            <p>N° de Pedido: @order.OrderNumber</p>
                                                            <span class="@textClass text-capitalize-first">@order.Status.ToString()</span>
                                                        </figcaption>
                                                    </figure>
                                                </div>
                                            }

                                        }
                                        else
                                        {
                                            <div class="col-md-12">
                                                <p class="text-danger">No hay pedidos recientes.</p>
                                            </div>
                                        }

                                    </div>
                                </div>
                            </div>

                            <div class="tab-pane fade" id="v-pills-od" role="tabpanel" aria-labelledby="v-pills-od-tab">
                                <div class="card-body">
                                    <h4>Todos los Pedidos</h4>
                                    <hr />
                                    <div>
                                        <form asp-area="Client" asp-controller="Order" asp-action="Index" method="get" class="row" id="frmTable">
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label class="font-weight-bold">Fecha Inicial</label>
                                                    <input type="date"
                                                           asp-for="Filters.StartDate"
                                                           name="@(nameof(Model.Filters.StartDate))"
                                                           class="form-control-original-small" />
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label class="font-weight-bold">Fecha Final</label>
                                                    <input type="date"
                                                           asp-for="Filters.EndDate"
                                                           name="@(nameof(Model.Filters.EndDate))"
                                                           class="form-control-original-small" />
                                                </div>
                                            </div>

                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label class="font-weight-bold">Estado</label>
                                                    <select asp-items="Html.GetEnumSelectList<OrderStatus>()"
                                                            name="@(nameof(Model.Filters.Status))"
                                                            class="form-control-original-small">
                                                        <option>TODOS</option>
                                                    </select>
                                                </div>
                                            </div>

                                            <div class="col-md-3 d-flex">
                                                <div class="align-self-center mx-auto mb-3 mb-md-0" style=" width: 120px;">
                                                    <button type="submit" class="btn btn-primary btn-block">Filtrar</button>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                    <div id="divTableAllOrders">
                                        @{ await Html.RenderPartialAsync("_MyOrdersTablePartial", Model); }
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </article>
            </main>
        </div>
    </div>
</section>

<section class="section-name bg padding-y">
    <div class="container">
        <h6>Cancelación de Pedidos</h6>
        <p>
            No puedes cancelar pedidos que tengan más de 5 minutos de haber sido realizados.
        </p>
    </div>
</section>


@section Scripts{

    <script src="~/js/myOrders.index.js"></script>
}


